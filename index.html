<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    input, button, select {
      font-size: 1rem;
      margin: 5px;
    }
    .output {
      margin-top: 20px;
      white-space: pre-wrap;
      background-color: #f9f9f9;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>

  <label for="name">åå‰: </label>
  <input type="text" id="name" placeholder="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å"><br>

  <label for="rank">éšç´š (1ä»¥ä¸Š): </label>
  <input type="number" id="rank" min="1" value="1"><br>

  <label for="build">ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—: </label>
  <select id="build"></select><br>

  <button id="generateBtn" onclick="generate()" disabled>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”Ÿæˆ</button>

  <div class="output" id="output"></div>

  <script>
    let titles = [];
    let buildTypes = {};

    // äºŒã¤åã®èª­ã¿è¾¼ã¿
    fetch("titles.json")
      .then(response => response.json())
      .then(data => {
        titles = data;
        checkReady();
      });

    // ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã®èª­ã¿è¾¼ã¿
    fetch("buildTypes.json")
      .then(response => response.json())
      .then(data => {
        buildTypes = data;
        const buildSelect = document.getElementById("build");

        // ã€Œãƒ©ãƒ³ãƒ€ãƒ ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠï¼‰
        const randomOpt = document.createElement("option");
        randomOpt.value = "__RANDOM__";
        randomOpt.textContent = "ãƒ©ãƒ³ãƒ€ãƒ ";
        randomOpt.selected = true;
        buildSelect.appendChild(randomOpt);

        // ãã®ä»–ã®ãƒ“ãƒ«ãƒ‰ã‚’è¿½åŠ 
        for (const key in buildTypes) {
          const opt = document.createElement("option");
          opt.value = key;
          opt.textContent = key;
          buildSelect.appendChild(opt);
        }

        checkReady();
      });

    function checkReady() {
      if (titles.length > 0 && Object.keys(buildTypes).length > 0) {
        document.getElementById("generateBtn").disabled = false;
      }
    }

    function generateStatus(rank, buildType) {
      const basePoints = rank * 50;
      const minPoints = Math.floor(basePoints * 0.8);
      const maxPoints = Math.ceil(basePoints * 1.5);
      const totalPoints = Math.floor(Math.random() * (maxPoints - minPoints + 1)) + minPoints;

      const ratio = buildTypes[buildType];
      const rawDistribution = {};
      let usedPoints = 0;

      for (const key in ratio) {
        const val = Math.floor(totalPoints * ratio[key]);
        rawDistribution[key] = val;
        usedPoints += val;
      }

      // ä½™ã‚Šã‚’è¨˜æ†¶åŠ›ã¸
      const remainder = totalPoints - usedPoints;
      rawDistribution["è¨˜æ†¶åŠ›"] += remainder;

      const finalStatus = {
        HP: rawDistribution.HP * 3,
        MP: rawDistribution.MP * 3,
        ATK: rawDistribution.ATK,
        DEF: rawDistribution.DEF,
        DEX: rawDistribution.DEX,
        è¨˜æ†¶åŠ›: Math.floor(rawDistribution["è¨˜æ†¶åŠ›"] / 5)
      };

      return {
        rank,
        totalPoints,
        buildType,
        rawDistribution,
        finalStatus
      };
    }

    function generate() {
      const name = document.getElementById("name").value.trim() || "åç„¡ã—";
      const rank = parseInt(document.getElementById("rank").value, 10);
      let buildType = document.getElementById("build").value;

      if (buildType === "__RANDOM__") {
        const keys = Object.keys(buildTypes);
        buildType = keys[Math.floor(Math.random() * keys.length)];
      }

      const result = generateStatus(rank, buildType);
      const title = titles[Math.floor(Math.random() * titles.length)];
      const output = document.getElementById("output");

      output.innerHTML =
        `ğŸ‘¤ åå‰: ${name}ã€${title}\n` +
        `ğŸ·ï¸ ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—: ${result.buildType}\n` +
        `ğŸ”¹ éšç´š: ${result.rank}\n` +
        `ğŸ”¸ ä½¿ç”¨ãƒã‚¤ãƒ³ãƒˆ: ${result.totalPoints}\n\n` +
        `ğŸ² æŒ¯ã‚Šåˆ†ã‘:\n` +
        Object.entries(result.rawDistribution).map(([key, val]) => `${key}: ${val}`).join("\n") +
        `\n\nğŸ“Š æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:\n` +
        Object.entries(result.finalStatus).map(([key, val]) => `${key}: ${val}`).join("\n");
    }
  </script>
</body>
</html>
