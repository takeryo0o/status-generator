<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    input, button {
      font-size: 1rem;
      margin: 5px;
    }
    .output {
      margin-top: 20px;
      white-space: pre-wrap;
      background-color: #f9f9f9;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>

  <label for="name">åå‰: </label>
  <input type="text" id="name" placeholder="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å"><br>

  <label for="rank">éšç´š (1ã€œ20): </label>
  <input type="number" id="rank" min="1" max="20" value="1">
  <button id="generateBtn" onclick="generate()" disabled>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”Ÿæˆ</button>

  <div class="output" id="output"></div>

  <script>
    let titles = [];

    fetch("titles.json")
      .then(response => response.json())
      .then(data => {
        titles = data.titles || data; // JSONã®å½¢å¼ã«å¯¾å¿œ
        console.log("äºŒã¤åèª­ã¿è¾¼ã¿å®Œäº†:", titles.length, "ä»¶");
        document.getElementById("generateBtn").disabled = false;
      })
      .catch(error => {
        console.error("äºŒã¤åã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
      });

    function generateStatus(rank) {
      let basePoints = 0;
      if (rank >= 1 && rank <= 10) {
        basePoints = 30 + (rank - 1) * 30;
      } else if (rank >= 11 && rank <= 17) {
        basePoints = 300 + (rank - 10) * 20;
      } else if (rank >= 18 && rank <= 20) {
        basePoints = 440 + (rank - 17) * 50;
      } else {
        return { error: "ãƒ©ãƒ³ã‚¯ã¯1ã€œ20ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚" };
      }

      const minPoints = Math.floor(basePoints * 0.8);
      const maxPoints = Math.ceil(basePoints * 1.2);
      const totalPoints = Math.floor(Math.random() * (maxPoints - minPoints + 1)) + minPoints;

      const keys = ["HP", "MP", "ATK", "DEF", "DEX", "è¨˜æ†¶åŠ›"];
      const weights = keys.map(() => Math.random() + 0.5); // åã‚Šã‚’ä½œã‚‹ãƒ©ãƒ³ãƒ€ãƒ é‡ã¿ (0.5ã€œ1.5)

      let distribution = {};
      keys.forEach(k => distribution[k] = 0);

      let remaining = totalPoints;
      while (remaining > 0) {
        const weightedKeys = keys.map((k, i) => ({ key: k, weight: weights[i] }));
        const totalWeight = weightedKeys.reduce((sum, item) => sum + item.weight, 0);
        let rnd = Math.random() * totalWeight;
        for (const item of weightedKeys) {
          rnd -= item.weight;
          if (rnd <= 0) {
            distribution[item.key]++;
            break;
          }
        }
        remaining--;
      }

      const finalStatus = {
        HP: distribution.HP * 3,
        MP: distribution.MP * 3,
        ATK: distribution.ATK,
        DEF: distribution.DEF,
        DEX: distribution.DEX,
        è¨˜æ†¶åŠ›: Math.floor(distribution["è¨˜æ†¶åŠ›"] / 5)
      };

      return {
        rank,
        totalPoints,
        distribution,
        finalStatus
      };
    }

    function generate() {
      if (titles.length === 0) {
        alert("äºŒã¤åãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã†å°‘ã—å¾…ã£ã¦ãã ã•ã„ã€‚");
        return;
      }

      const name = document.getElementById("name").value.trim() || "åç„¡ã—";
      const rank = parseInt(document.getElementById("rank").value, 10);
      const result = generateStatus(rank);
      const output = document.getElementById("output");

      if (result.error) {
        output.textContent = result.error;
        return;
      }

      const title = titles[Math.floor(Math.random() * titles.length)];

      output.innerHTML =
        `ğŸ‘¤ åå‰: ${name}ã€${title}\n` +
        `ğŸ”¹ éšç´š: ${result.rank}\n` +
        `ğŸ”¸ ä½¿ç”¨ãƒã‚¤ãƒ³ãƒˆ: ${result.totalPoints}\n\n` +
        `ğŸ² æŒ¯ã‚Šåˆ†ã‘:\n` +
        Object.entries(result.distribution).map(([key, val]) => `${key}: ${val}`).join("\n") +
        `\n\nğŸ“Š æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:\n` +
        Object.entries(result.finalStatus).map(([key, val]) => `${key}: ${val}`).join("\n");
    }
  </script>
</body>
</html>
